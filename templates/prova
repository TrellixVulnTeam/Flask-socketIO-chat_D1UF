const form = document.querySelector('#NicknameForm');


    
if (!localStorage.getItem('nickname'))  
    form.style.display = "block";
    form.addEventListener('submit', event => {
        const name = document.querySelector('#NickNameInput').value;
        if (name === "") {
            alert("Please insert nickname");
            return;
        };
        localStorage.setItem('nickname', name);
        document.querySelector("#nickname").innerHTML = name;
        form.style.display = "none";
        const request = new XMLHttpRequest();
        request.open('GET', '/login');
                request.onload = () => {
        event.preventDefault();
    });


document.addEventListener('DOMContentLoaded', () => {


    document.querySelector('#nickname').innerHTML = localStorage.getItem('nickname');
    const name = document.querySelector('#nickname').innerHTML;
    const request = new XMLHttpRequest();




    const formchannel = document.querySelector('#CreateChannel');
let username; 
let channels = [];
function addchannel(arrchannels, singlechannel) {
    if (!arrchannels.includes(singlechannel)){
        arrchannels.push(singlechannel);
        const li = document.createElement('li');
        li.innerHTML = singlechannel;
         // Add new item to channel list
        document.querySelector('#Channels').append(li);
    }
    else {
        window.alert("The channel already exists");
        return false;
    }        
}

//localStorage.setItem("channels", JSON.stringify(channels));
//channels = JSON.parse(localStorage.getItem("channels"));


// Initialize new request
//const request = new XMLHttpRequest();
//const currency = document.querySelector('#currency').value;
//request.open('POST', '/convert');

// Callback function for when request completes
/*request.onload = () => {

    // Extract JSON data from request
    const data = JSON.parse(request.responseText);

    // Update the result div
    if (data.success) {
        const contents = `1 USD is equal to ${data.rate} ${currency}.`
        document.querySelector('#result').innerHTML = contents;
    }
    else {
        document.querySelector('#result').innerHTML = 'There was an error.';
    }
} */



document.addEventListener('DOMContentLoaded', () => {

    if (!localStorage.getItem('nickname')) {
        username = window.prompt("Enter you nickname","username" + (Math.ceil(Math.random() * 100)));
        localStorage.setItem('nickname', username)

    }
    username = localStorage.getItem('nickname')

    // By default, submit button is disabled
    document.querySelector('#submit').disabled = true;

    // Enable button only if there is text in the input field
    document.querySelector('#Channel').onkeyup = () => {
        if (document.querySelector('#Channel').value.length > 0) {
            document.querySelector('#submit').disabled = false;
        }
        else {
            document.querySelector('#submit').disabled = true;
        }
    }

    formchannel.addEventListener('submit', event => {

        // Create new item for list
        lt channel = document.querySelector('#Channel').value;
        console.log('canale creato')
        addchannel(channels, channel);
        console.log('canale aggiunto')

        // Initialize new request
        const request = new XMLHttpRequest();
        request.open('POST', '/savechannel');

        // Callback function for when request completes
        request.onload = () => {

            // Extract JSON data from request
            const data = JSON.parse(request.responseText);
        }
        
        // Clear input field and disable button again
        document.querySelector('#Channel').value = '';
        document.querySelector('#submit').disabled = true;

        // Stop form from submitting
        event.preventDefault();  
    })
});


